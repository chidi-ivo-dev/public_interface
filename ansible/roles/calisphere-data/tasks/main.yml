---
- name: include vaulted passwords from vaulted.yml
  include_vars: vaulted.yml
- name: upgrade all packages
  become: yes
  yum:
    name: '*'
    state: latest
- name: enable the extended epel repo (for redis)
  become: yes
  command: yum-config-manager --enable epel
- name: install needed packages
  become: yes
  yum: "pkg={{ item }} state=latest"
  with_items:
    - git
    - gcc
    - make
    - python27-pip
    - redis
- name: create the environment variable file
  template:
    src: env.local.j2
    dest: ~/env.local
- name: clone public interface
  git:
    repo: https://github.com/ucldc/public_interface.git
    dest: ~/code/public_interface
    update: yes
- name: install public interface dependencies
  become: yes
  pip:
    requirements: /home/ec2-user/code/public_interface/requirements.txt
